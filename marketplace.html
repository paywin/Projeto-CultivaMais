<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketplace - Cultiva+</title>
    <link rel="shortcut icon" href="./imagens/cabeca.png" type="image/x-icon">
    <link rel="stylesheet" href="./css/marketplace.css">
</head>
<body>

<header>
    <a href="index.html" class="logo">
        <img src="./imagens/cabeca.png" alt="Cultiva+">
        CULTIVA+
    </a>
    <nav>
        <a href="index.html">IN√çCIO</a>
        <a href="#" class="active">MARKETPLACE</a>
        <a href="#">CLIMA</a>
        <a href="#">AGRO-CONECTA</a>
        <a href="sobre.html">SOBRE N√ìS</a>
        <a href="contato.html">CONTATO</a>
    </nav>
    <div class="header-actions">
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Buscar produtos...">
            <button id="search-btn">üîç</button>
        </div>
        <button class="cart-btn">
            üõí
            <span class="cart-count" id="cart-count">0</span>
        </button>
    </div>
</header>

<div class="marketplace-container">
    <aside class="filters-sidebar">
        <h3>Filtrar Produtos</h3>
        
        <div class="filter-group">
            <h4>Categorias</h4>
            <div class="filter-options" id="category-filters">
                <label class="filter-option">
                    <input type="checkbox" value="frutas"> Frutas
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="verduras"> Verduras
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="legumes"> Legumes
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="graos"> Gr√£os
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="organicos"> Org√¢nicos
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="temperos"> Temperos
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="bebidas"> Bebidas
                </label>
            </div>
        </div>
        
        <div class="filter-group">
            <h4>Pre√ßo</h4>
            <div class="price-filter">
                <div class="price-inputs">
                    <input type="number" id="min-price" placeholder="M√≠n" min="0">
                    <input type="number" id="max-price" placeholder="M√°x" min="0">
                </div>
                <input type="range" id="price-range" min="0" max="100" value="100" class="price-range">
                <div class="price-values">
                    <span>R$ 0</span>
                    <span id="max-price-value">R$ 100+</span>
                </div>
            </div>
        </div>
        
        <div class="filter-group">
            <h4>Agricultor</h4>
            <div class="filter-options" id="farmer-filters">
                <label class="filter-option">
                    <input type="checkbox" value="Familia Silva"> Fam√≠lia Silva
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="Sitio Esperanca"> S√≠tio Esperan√ßa
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="Chacara Boa Vista"> Ch√°cara Boa Vista
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="Organicos da Terra"> Org√¢nicos da Terra
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="Fazenda Nova"> Fazenda Nova
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="Harpa Agricola"> Harpa Agr√≠cola
                </label>
            </div>
        </div>
        
        <div class="filter-group">
            <h4>Avalia√ß√£o</h4>
            <div class="filter-options" id="rating-filters">
                <label class="filter-option">
                    <input type="checkbox" value="5"> ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="4"> ‚≠ê‚≠ê‚≠ê‚≠ê
                </label>
                <label class="filter-option">
                    <input type="checkbox" value="3"> ‚≠ê‚≠ê‚≠ê
                </label>
            </div>
        </div>

        <div class="filter-buttons">
            <button class="filter-btn apply-btn" id="apply-filters">Aplicar Filtros</button>
            <button class="filter-btn reset-btn" id="reset-filters">Limpar Filtros</button>
        </div>
    </aside>
    
    <main class="products-grid" id="products-grid">
        <!-- Produtos ser√£o renderizados via JavaScript -->
    </main>
    
    <aside class="cart-sidebar">
        <h3>Meu Carrinho</h3>
        
        <div class="cart-items" id="cart-items">
            <div class="empty-cart" id="empty-cart">Seu carrinho est√° vazio</div>
            <!-- Itens do carrinho ser√£o renderizados via JavaScript -->
        </div>
        
        <div class="cart-total">
            <span>Total:</span>
            <span id="cart-total">R$ 0,00</span>
        </div>
        
        <button class="checkout-btn">Finalizar Compra</button>
    </aside>
</div>

<a href="chatbot.html">
    <img src="./imagens/cabeca.png" alt="Mascote" class="mascote-btn">
</a>

<script>
    // Dados dos produtos
    const products = [
        {
            id: 1,
            name: "Tomate Org√¢nico",
            farmer: "Fam√≠lia Silva",
            location: "S√£o Paulo",
            description: "Tomates vermelhos maduros, cultivados sem agrot√≥xicos. Colhidos na manh√£ da entrega.",
            price: 8.90,
            unit: "kg",
            category: ["frutas", "organicos"],
            rating: 4.2,
            reviews: 42,
            emoji: "üçÖ"
        },
        {
            id: 2,
            name: "Alface Crespa",
            farmer: "S√≠tio Esperan√ßa",
            location: "Minas Gerais",
            description: "Alface crespa fresquinha, hidrop√¥nica. Perfeita para saladas e sandu√≠ches.",
            price: 4.50,
            unit: "unid",
            category: ["verduras"],
            rating: 5,
            reviews: 37,
            emoji: "ü•¨"
        },
        {
            id: 3,
            name: "Morango Doce",
            farmer: "Ch√°cara Boa Vista",
            location: "Rio de Janeiro",
            description: "Morangos vermelhos e doces, cultivados com t√©cnicas sustent√°veis de produ√ß√£o.",
            price: 12.90,
            unit: "caixa",
            category: ["frutas"],
            rating: 4.5,
            reviews: 28,
            emoji: "üçì"
        },
        {
            id: 4,
            name: "Cenoura Org√¢nica",
            farmer: "Org√¢nicos da Terra",
            location: "Paran√°",
            description: "Cenouras crocantes e saborosas, cultivadas sem pesticidas ou produtos qu√≠micos.",
            price: 5.80,
            unit: "kg",
            category: ["legumes", "organicos"],
            rating: 5,
            reviews: 51,
            emoji: "ü•ï"
        },
        {
            id: 5,
            name: "Lim√£o Taiti",
            farmer: "Fam√≠lia Silva",
            location: "S√£o Paulo",
            description: "Lim√µes suculentos e √°cidos, perfeitos para sucos, temperos e drinks.",
            price: 6.20,
            unit: "kg",
            category: ["frutas"],
            rating: 4.5,
            reviews: 33,
            emoji: "üçã"
        },
        {
            id: 6,
            name: "Batata Ingreda",
            farmer: "S√≠tio Esperan√ßa",
            location: "Minas Gerais",
            description: "Batatas selecionadas, ideais para cozinhar, assar ou fazer pur√™.",
            price: 7.30,
            unit: "kg",
            category: ["legumes"],
            rating: 4.5,
            reviews: 29,
            emoji: "ü•î"
        },
        {
            id: 7,
            name: "Arroz Integral",
            farmer: "Ch√°cara Boa Vista",
            location: "Rio de Janeiro",
            description: "Arroz integral org√¢nico, rico em fibras e nutrientes.",
            price: 9.80,
            unit: "kg",
            category: ["graos", "organicos"],
            rating: 4.7,
            reviews: 45,
            emoji: "üåæ"
        },
        {
            id: 8,
            name: "Feij√£o Carioca",
            farmer: "Org√¢nicos da Terra",
            location: "Paran√°",
            description: "Feij√£o de alta qualidade, colhido recentemente e selecionado.",
            price: 8.50,
            unit: "kg",
            category: ["graos"],
            rating: 4.8,
            reviews: 38,
            emoji: "ü´ò"
        },
        {
            id: 9,
            name: "Banana Prata",
            farmer: "Fazenda Nova",
            location: "Bahia",
            description: "Bananas maduras e saborosas, perfeitas para vitaminas e sobremesas.",
            price: 5.90,
            unit: "kg",
            category: ["frutas"],
            rating: 4.6,
            reviews: 67,
            emoji: "üçå"
        },
        {
            id: 10,
            name: "Abacate Hass",
            farmer: "Harpa Agr√≠cola",
            location: "Esp√≠rito Santo",
            description: "Abacates cremosos e saborosos, ideais para guacamole e vitaminas.",
            price: 12.50,
            unit: "kg",
            category: ["frutas"],
            rating: 4.9,
            reviews: 53,
            emoji: "ü•ë"
        },
        {
            id: 11,
            name: "Cebola Roxa",
            farmer: "S√≠tio Esperan√ßa",
            location: "Minas Gerais",
            description: "Cebolas roxas frescas, com sabor suave e adocicado.",
            price: 6.75,
            unit: "kg",
            category: ["legumes"],
            rating: 4.4,
            reviews: 31,
            emoji: "üßÖ"
        },
        {
            id: 12,
            name: "Alho Nacional",
            farmer: "Fam√≠lia Silva",
            location: "S√£o Paulo",
            description: "Alho fresco e arom√°tico, colhido recentemente.",
            price: 15.90,
            unit: "kg",
            category: ["temperos"],
            rating: 4.7,
            reviews: 44,
            emoji: "üßÑ"
        },
        {
            id: 13,
            name: "Piment√£o Vermelho",
            farmer: "Ch√°cara Boa Vista",
            location: "Rio de Janeiro",
            description: "Piment√µes vermelhos doces, ricos em vitamins.",
            price: 9.90,
            unit: "kg",
            category: ["legumes"],
            rating: 4.5,
            reviews: 39,
            emoji: "ü´ë"
        },
        {
            id: 14,
            name: "Mel Puro",
            farmer: "Org√¢nicos da Terra",
            location: "Paran√°",
            description: "Mel 100% puro, colhido de forma sustent√°vel.",
            price: 28.90,
            unit: "500g",
            category: ["organicos", "bebidas"],
            rating: 5,
            reviews: 72,
            emoji: "üçØ"
        },
        {
            id: 15,
            name: "Caf√© Especial",
            farmer: "Fazenda Nova",
            location: "Bahia",
            description: "Caf√© especial torrado recentemente, aroma intenso.",
            price: 24.90,
            unit: "500g",
            category: ["bebidas", "organicos"],
            rating: 4.9,
            reviews: 88,
            emoji: "‚òï"
        },
        {
            id: 16,
            name: "Cheiro Verde",
            farmer: "Harpa Agr√≠cola",
            location: "Esp√≠rito Santo",
            description: "Salsinha e cebolinha frescas, colhidas diariamente.",
            price: 3.50,
            unit: "ma√ßo",
            category: ["temperos"],
            rating: 4.8,
            reviews: 47,
            emoji: "üåø"
        }
    ];

    // Estado da aplica√ß√£o
    let cart = [];
    let filteredProducts = [...products];
    let searchTerm = '';
    let selectedCategories = [];
    let selectedFarmers = [];
    let minPrice = 0;
    let maxPrice = 100;
    let selectedRatings = [];

    // Elementos do DOM
    const productsGrid = document.getElementById('products-grid');
    const cartItems = document.getElementById('cart-items');
    const cartTotal = document.getElementById('cart-total');
    const cartCount = document.getElementById('cart-count');
    const emptyCart = document.getElementById('empty-cart');
    const searchInput = document.getElementById('search-input');
    const searchBtn = document.getElementById('search-btn');
    const minPriceInput = document.getElementById('min-price');
    const maxPriceInput = document.getElementById('max-price');
    const priceRange = document.getElementById('price-range');
    const maxPriceValue = document.getElementById('max-price-value');
    const applyFiltersBtn = document.getElementById('apply-filters');
    const resetFiltersBtn = document.getElementById('reset-filters');

    // Inicializar a aplica√ß√£o
    function init() {
        renderProducts();
        setupEventListeners();
        updateCartUI();
    }

    // Configurar event listeners
    function setupEventListeners() {
        // Pesquisa
        searchBtn.addEventListener('click', handleSearch);
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSearch();
        });

        // Filtros de pre√ßo
        minPriceInput.addEventListener('input', handlePriceInput);
        maxPriceInput.addEventListener('input', handlePriceInput);
        priceRange.addEventListener('input', handlePriceRange);

        // Bot√µes de filtro
        applyFiltersBtn.addEventListener('click', applyFilters);
        resetFiltersBtn.addEventListener('click', resetFilters);

        // Prevenir que o clique nos inputs de pre√ßo propague para o produto
        minPriceInput.addEventListener('click', (e) => e.stopPropagation());
        maxPriceInput.addEventListener('click', (e) => e.stopPropagation());
        minPriceInput.addEventListener('focus', (e) => e.stopPropagation());
        maxPriceInput.addEventListener('focus', (e) => e.stopPropagation());
        
        // Prevenir que o clique nos checkboxes propague
        document.querySelectorAll('.filter-option input').forEach(input => {
            input.addEventListener('click', (e) => e.stopPropagation());
        });
    }

    // Manipuladores de filtros
    function handlePriceInput() {
        minPrice = minPriceInput.value ? parseInt(minPriceInput.value) : 0;
        maxPrice = maxPriceInput.value ? parseInt(maxPriceInput.value) : 100;
        
        // Atualizar o slider de pre√ßo
        priceRange.value = maxPrice;
        maxPriceValue.textContent = maxPrice === 100 ? 'R$ 100+' : `R$ ${maxPrice}`;
    }

    function handlePriceRange() {
        maxPrice = parseInt(priceRange.value);
        maxPriceInput.value = maxPrice === 100 ? '' : maxPrice;
        maxPriceValue.textContent = maxPrice === 100 ? 'R$ 100+' : `R$ ${maxPrice}`;
    }

    function handleSearch() {
        searchTerm = searchInput.value.toLowerCase();
        applyFilters();
    }

    // Aplicar filtros
    function applyFilters() {
        // Obter categorias selecionadas
        selectedCategories = Array.from(document.querySelectorAll('#category-filters input:checked'))
            .map(input => input.value);
        
        // Obter agricultores selecionados
        selectedFarmers = Array.from(document.querySelectorAll('#farmer-filters input:checked'))
            .map(input => input.value);
        
        // Obter avalia√ß√µes selecionadas
        selectedRatings = Array.from(document.querySelectorAll('#rating-filters input:checked'))
            .map(input => parseInt(input.value));
        
        // Obter pre√ßos
        minPrice = minPriceInput.value ? parseInt(minPriceInput.value) : 0;
        maxPrice = maxPriceInput.value ? parseInt(maxPriceInput.value) : 100;
        if (maxPriceInput.value === '') maxPrice = 100; // "Qualquer pre√ßo"

        // Aplicar filtros
        filteredProducts = products.filter(product => {
            // Filtro por texto de pesquisa
            const matchesSearch = searchTerm === '' || 
                product.name.toLowerCase().includes(searchTerm) ||
                product.description.toLowerCase().includes(searchTerm) ||
                product.farmer.toLowerCase().includes(searchTerm);
            
            // Filtro por categoria
            const matchesCategory = selectedCategories.length === 0 || 
                product.category.some(cat => selectedCategories.includes(cat));
            
            // Filtro por agricultor
            const normalizedFarmer = product.farmer.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s/g, '');
            const matchesFarmer = selectedFarmers.length === 0 || 
                selectedFarmers.includes(normalizedFarmer);
            
            // Filtro por pre√ßo
            const matchesPrice = product.price >= minPrice && product.price <= maxPrice;
            
            // Filtro por avalia√ß√£o
            const matchesRating = selectedRatings.length === 0 || 
                selectedRatings.some(rating => Math.floor(product.rating) === rating);
            
            return matchesSearch && matchesCategory && matchesFarmer && matchesPrice && matchesRating;
        });
        
        renderProducts();
    }

    // Limpar filtros
    function resetFilters() {
        // Limpar inputs de pesquisa e pre√ßo
        searchInput.value = '';
        minPriceInput.value = '';
        maxPriceInput.value = '';
        priceRange.value = 100;
        
        // Desmarcar todas as checkboxes
        document.querySelectorAll('#category-filters input').forEach(input => input.checked = false);
        document.querySelectorAll('#farmer-filters input').forEach(input => input.checked = false);
        document.querySelectorAll('#rating-filters input').forEach(input => input.checked = false);
        
        // Resetar valores
        searchTerm = '';
        selectedCategories = [];
        selectedFarmers = [];
        minPrice = 0;
        maxPrice = 100;
        selectedRatings = [];
        maxPriceValue.textContent = 'R$ 100+';
        
        // Aplicar filtros (que agora n√£o filtram nada)
        applyFilters();
    }

    // Renderizar produtos
    function renderProducts() {
        productsGrid.innerHTML = '';
        
        if (filteredProducts.length === 0) {
            productsGrid.innerHTML = '<div class="empty-cart">Nenhum produto encontrado com os filtros selecionados.</div>';
            return;
        }
        
        filteredProducts.forEach(product => {
            const productCard = document.createElement('div');
            productCard.className = 'product-card';
            productCard.innerHTML = `
                <div class="product-image">${product.emoji}</div>
                <div class="product-info">
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-farmer">${product.farmer} - ${product.location}</p>
                    <p class="product-description">${product.description}</p>
                    <div class="product-meta">
                        <span class="product-price">R$ ${product.price.toFixed(2)}/${product.unit}</span>
                        <span class="product-rating">${getStarRating(product.rating)} (${product.reviews})</span>
                    </div>
                    <button class="add-to-cart" data-id="${product.id}">Adicionar ao Carrinho</button>
                </div>
            `;
            
            productsGrid.appendChild(productCard);
        });
        
        // Adicionar event listeners aos bot√µes
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', (e) => {
                const productId = parseInt(e.target.getAttribute('data-id'));
                addToCart(productId);
            });
        });
    }

    // Obter representa√ß√£o em estrelas da avalia√ß√£o
    function getStarRating(rating) {
        const fullStars = Math.floor(rating);
        const halfStar = rating % 1 >= 0.5;
        const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
        
        return '‚≠ê'.repeat(fullStars) + (halfStar ? '‚≠ê' : '') + '‚òÜ'.repeat(emptyStars);
    }

    // Adicionar produto ao carrinho
    function addToCart(productId) {
        const product = products.find(p => p.id === productId);
        const existingItem = cart.find(item => item.id === productId);
        
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            cart.push({
                ...product,
                quantity: 1
            });
        }
        
        updateCartUI();
        
        // Feedback visual
        const button = document.querySelector(`.add-to-cart[data-id="${productId}"]`);
        const originalText = button.textContent;
        button.textContent = "‚úì Adicionado!";
        button.style.background = "#2e7d32";
        
        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = "";
        }, 1500);
    }

    // Atualizar quantidade no carrinho
    function updateQuantity(productId, change) {
        const item = cart.find(item => item.id === productId);
        
        if (item) {
            item.quantity += change;
            
            if (item.quantity <= 0) {
                cart = cart.filter(item => item.id !== productId);
            }
            
            updateCartUI();
        }
    }

    // Remover item do carrinho
    function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        updateCartUI();
    }

    // Atualizar interface do carrinho
    function updateCartUI() {
        // Atualizar contador
        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
        cartCount.textContent = totalItems;
        
        // Atualizar lista de itens
        if (cart.length === 0) {
            emptyCart.style.display = 'block';
            cartItems.innerHTML = '';
            cartItems.appendChild(emptyCart);
        } else {
            emptyCart.style.display = 'none';
            cartItems.innerHTML = '';
            
            cart.forEach(item => {
                const cartItem = document.createElement('div');
                cartItem.className = 'cart-item';
                cartItem.innerHTML = `
                    <div class="cart-item-image">${item.emoji}</div>
                    <div class="cart-item-details">
                        <div class="cart-item-title">${item.name}</div>
                        <div class="cart-item-price">R$ ${item.price.toFixed(2)}/${item.unit}</div>
                    </div>
                    <div class="cart-item-actions">
                        <button class="quantity-btn" data-id="${item.id}" data-change="-1">-</button>
                        <span class="cart-item-quantity">${item.quantity}</span>
                        <button class="quantity-btn" data-id="${item.id}" data-change="1">+</button>
                        <button class="remove-item" data-id="${item.id}">√ó</button>
                    </div>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            // Adicionar event listeners aos bot√µes
            document.querySelectorAll('.quantity-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    const change = parseInt(e.target.getAttribute('data-change'));
                    updateQuantity(productId, change);
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.getAttribute('data-id'));
                    removeFromCart(productId);
                });
            });
        }
        
        // Atualizar total
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        cartTotal.textContent = `R$ ${total.toFixed(2)}`;
    }

    // Inicializar a aplica√ß√£o
    init();
</script>

</body>
</html>